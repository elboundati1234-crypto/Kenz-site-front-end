<main class="flex-grow-1 bg-light min-vh-100">
    <div class="container py-5" style="max-width: 1200px;">

        <div class="mb-5">
            <h1 class="display-4 fw-bold text-dark mb-3 lh-1">Explore Upcoming Events</h1>
            <p class="fs-5 text-secondary fw-normal mb-0" style="max-width: 650px;">
                Connect, Learn, Grow: Discover academic opportunities, workshops, and conferences.
            </p>
        </div>

        <div class="search-bar-container mb-5 d-flex flex-column flex-lg-row align-items-stretch align-items-lg-center gap-3">
            
            <div class="flex-grow-1 position-relative">
                <span class="material-symbols-outlined search-icon" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #6c757d;">search</span>
                <input type="text" class="form-control form-control-custom rounded-3 py-2 ps-5"
                    placeholder="Search for workshops, fairs..." 
                    [(ngModel)]="searchTerm"
                    (keyup.enter)="applyFilters()">
            </div>

            <div class="d-flex flex-wrap align-items-center gap-2">
                
                <div class="dropdown">
                    <button class="btn btn-white border rounded-3 py-2 px-3 d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" style="background-color: white;">
                        {{ selectedLocation || 'Location' }} 
                        <span class="material-symbols-outlined fs-5 text-secondary">keyboard_arrow_down</span>
                    </button>
                    <ul class="dropdown-menu shadow border-0">
                        <li><a class="dropdown-item" role="button" (click)="setLocation('')">All Locations</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setLocation('Online')">Online</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setLocation('Morocco')">Morocco</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setLocation('Japan')">Japan</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setLocation('USA')">USA</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setLocation('Netherlands')">Netherlands</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setLocation('Germany')">Germany</a></li>
                    </ul>
                </div>

                <div class="dropdown">
                    <button class="btn btn-white border rounded-3 py-2 px-3 d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown" style="background-color: white;">
                        {{ selectedDate ? (selectedDate === 'thisWeek' ? 'This Week' : 'Next Month') : 'Date' }}
                        <span class="material-symbols-outlined fs-5 text-secondary">keyboard_arrow_down</span>
                    </button>
                    <ul class="dropdown-menu shadow border-0">
                        <li><a class="dropdown-item" role="button" (click)="setDate('')">Anytime</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setDate('thisWeek')">This Week</a></li>
                        <li><a class="dropdown-item" role="button" (click)="setDate('nextMonth')">Next Month</a></li>
                    </ul>
                </div>

                <div class="vr mx-2 d-none d-sm-block text-secondary"></div>

                <button class="btn btn-white border rounded-3 py-2 px-3 text-secondary fw-medium d-flex align-items-center gap-2 hover-primary"
                    style="background-color: white;"
                    (click)="setSort(selectedSort === 'Newest' ? 'Oldest' : 'Newest')">
                    <span class="small">Sort: {{ selectedSort }}</span>
                    <span class="material-symbols-outlined fs-5">sort</span>
                </button>
            </div>
        </div>

        <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading events...</p>
        </div>

        <div *ngIf="!isLoading && filteredOpportunities.length === 0" class="text-center py-5">
            <span class="material-symbols-outlined fs-1 text-secondary mb-3">event_busy</span>
            <p class="text-muted fs-5">No events found matching your filters.</p>
            <button class="btn btn-outline-primary mt-2" (click)="searchTerm = ''; setLocation(''); setDate('')">Clear Filters</button>
        </div>

        <div *ngIf="!isLoading && filteredOpportunities.length > 0" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">

            <div class="col" *ngFor="let item of filteredOpportunities">
                <div class="card h-100 overflow-hidden bg-white shadow-sm border-0 transition-hover">
                    
                    <div style="position: relative; height: 200px; overflow: hidden;">
                        <img [src]="item.imageUrl" 
                             [alt]="item.title" 
                             class="w-100 h-100 object-fit-cover"
                             (error)="handleImageError($event)">

                        <span class="position-absolute top-0 end-0 m-3 badge rounded-pill px-3 py-2" 
                              [ngClass]="getBadgeClass(item.type)">
                            {{ item.type }}
                        </span>
                    </div>

                    <div class="card-body d-flex flex-column p-4">
                        <h5 class="card-title fw-bold text-dark mb-3 text-truncate-2">{{ item.title }}</h5>

                        <div class="d-flex flex-column gap-2 mb-3 text-secondary small">
                            
                            <div class="d-flex align-items-center gap-2">
                                <span class="material-symbols-outlined fs-6 text-primary">event</span>
                                <span class="fw-medium">{{ item.dateDebut | date:'dd/MM/yyyy' }}</span>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <span class="material-symbols-outlined fs-6 text-primary">
                                    {{ isOnline(item.location) ? 'videocam' : 'public' }}
                                </span>
                                <span>{{ item.location }}</span>
                            </div>

                            <div class="d-flex align-items-center gap-2" *ngIf="item.venue">
                                <span class="material-symbols-outlined fs-6 text-danger">location_on</span>
                                <span>{{ item.venue }}</span>
                            </div>
                        </div>

                        <p class="card-text text-secondary small mb-4 flex-grow-1"
                            style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                            {{ item.description }}
                        </p>

                        <button [routerLink]="['/details', item.id]"
                            class="btn btn-light w-100 fw-semibold text-primary border hover-bg-primary hover-text-white transition-all"
                            style="background-color: #f8fafc;">
                            View Details
                        </button>
                    </div>
                </div>
            </div>

        </div>

    </div>
</main>